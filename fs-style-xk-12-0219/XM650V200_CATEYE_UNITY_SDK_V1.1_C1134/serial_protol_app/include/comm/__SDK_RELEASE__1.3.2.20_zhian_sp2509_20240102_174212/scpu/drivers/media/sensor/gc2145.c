#include "board_kl520.h"
#if (IMGSRC_0_TYPE == SENSOR_TYPE_GC2145) || \
    (IMGSRC_1_TYPE == SENSOR_TYPE_GC2145)
#include <stdlib.h>
#include "base.h"
#include "framework/init.h"
#include "framework/v2k.h"
#include "framework/v2k_image.h"
#include "framework/framework_errno.h"
#include "framework/framework_driver.h"
#include "media/camera/sensor.h"
#include "kdp520_i2c.h"
#include "kdp_sensor.h"
#include "dbg.h"

#if IMGSRC_0_TYPE == SENSOR_TYPE_GC2145
#define IMG_RES             IMGSRC_0_RES
#define IMG_FORMAT          IMGSRC_0_FORMAT
#define IMG_MIPILANE_NUM    IMGSRC_0_MIPILANE_NUM
#define IMG_MIRROR          CFG_SENSOR_0_FMT_MIRROR
#define IMG_FLIP            CFG_SENSOR_0_FMT_FLIP
#endif
#if IMGSRC_1_TYPE == SENSOR_TYPE_GC2145
#define IMG_RES             IMGSRC_1_RES
#define IMG_FORMAT          IMGSRC_1_FORMAT
#define IMG_MIPILANE_NUM    IMGSRC_1_MIPILANE_NUM
#define IMG_MIRROR          CFG_SENSOR_1_FMT_MIRROR
#define IMG_FLIP            CFG_SENSOR_1_FMT_FLIP
#endif
#define IMG_WIDTH           RGB_IMG_SOURCE_W
#define IMG_HEIGHT          RGB_IMG_SOURCE_H

#if IMG_RES == RES_1600_1200
#define CROPPING_OFFSET_X   ((1600-IMG_WIDTH) >> 1)
#define CROPPING_OFFSET_Y   (0)
#else
#define CROPPING_OFFSET_X   ((800-IMG_WIDTH) >> 1)
#define CROPPING_OFFSET_Y   ((600-IMG_HEIGHT) >> 1)
#endif
#define ROI_OFFSET_X        ((CROPPING_OFFSET_X + 4) >> 3)
#define ROI_OFFSET_Y        ((CROPPING_OFFSET_Y + 4) >> 3)

//#define CFG_GC2145_X_Y_INVERSE  (1)
static const struct sensor_datafmt_info gc2145_colour_fmts[] = {
    { V2K_PIX_FMT_YCBCR, V2K_COLORSPACE_YUV },
    { V2K_PIX_FMT_RGB565, V2K_COLORSPACE_RGB },
}; 

static const struct sensor_win_size gc2145_supported_win_sizes[] = {    
    { .width = 400, .height = 600, },
    { .width = VGA_LANDSCAPE_WIDTH, .height = VGA_LANDSCAPE_HEIGHT, },    
    { .width = TFT43_WIDTH, .height = TFT43_HEIGHT, },     
    { .width = QVGA_WIDTH, .height = QVGA_HEIGHT, },
    { .width = UGA_WIDTH, .height = UGA_HEIGHT, },
};

static struct sensor_device gc2145_dev = {
    .addr = 0x3C,
    .device_id = 0XFFFF,
};

#if ( CFG_LW3D_TYPE == CFG_LW3D_940 )
#define LSC_ON YES
#define GAMMA_1 YES
#define GAMMA_2 YES
#define BLK_ON YES
#define AEC_ON YES
#define FPS_NORMAL NO
#define GC_FPS_30 YES

struct sensor_init_seq INITDATA gc2145_init_regs[] = {  
    //SENSORDB("GC2145MIPI_Sensor_Init");
    // reset : soft_reset, cm_reset, mipi_reset
    {0xfe, 0xf0}, 
    {0xfe, 0xf0}, 
    {0xfe, 0xf0}, 
    
    //pll / clock
    {0xfc, 0x06}, // vpll_en, vpix_en, analog pwd enable=0
    {0xf6, 0x00}, // up_dn : not pull. PWD : pull down
    {0xf7, 0x1d}, //PLL_mode1 [7]not dvp, serial_clk_double = 1, clk_double=1, div2_en=0, pll_en=1
#if GC_FPS_30 == YES	
    {0xf8, 0x86}, //PLL_mode2 [7]pll_dgdiv_en=1, [5:0]divx4 = 6
#else
    {0xf8, 0x84}, //PLL_mode2 [7]pll_dgdiv_en=1, [5:0]divx4 = 4
#endif
    {0xfa, 0x00}, //clk_div_mode [7:4]divide_by : 0, [3:0]clock_duty = 0
    {0xf9, 0x8e}, //regf clk enable, isp all clock enable, serial clk enable, re_lock_pll
    {0xf2, 0x00}, 
    
    /////////////////////////////////////////////////
    //////////////////ISP reg//////////////////////
    ////////////////////////////////////////////////////
    //reset release
    {0xfe, 0x00},     
    //Exposure : 1250
    {0x03, 0x04},
    {0x04, 0xe2},
    //Row Start
    {0x09, 0x00},
    {0x0a, 0x00},
    //Col Start
    {0x0b, 0x00},
    {0x0c, 0x00},
    //Window Height : 1216 , 4c0h
    {0x0d, 0x04},
    {0x0e, 0xc0},
    //Window Width : 1618
    {0x0f, 0x06},
    {0x10, 0x52},
    
    {0x12, 0x2e},
#if CFG_GC2145_X_Y_INVERSE
    {0x17, 0x16}, //updown or mirror[bit0]
#else
    {0x17, 0x15}, //updown or mirror[bit0]
#endif
    {0x18, 0x22},
    {0x19, 0x0e},
    {0x1a, 0x01},
    {0x1b, 0x4b},
    {0x1c, 0x07},
    {0x1d, 0x10},
    {0x1e, 0x88},
    {0x1f, 0x78},
    {0x20, 0x03},
    {0x21, 0x40},
    {0x22, 0xa0}, 
    {0x24, 0x16},
    {0x25, 0x01},
    {0x26, 0x10},
    {0x2d, 0x60},
    {0x30, 0x01},
    {0x31, 0x90},
    {0x33, 0x06},
    {0x34, 0x01},
    /////////////////////////////////////////////////
    //////////////////ISP reg////////////////////
    /////////////////////////////////////////////////
    {0xfe, 0x00},
    {0x80, 0x7f},
    {0x81, 0x26},
    {0x82, 0xf8},
    {0x83, 0x02}, //special effect
    
#if IMG_FORMAT == IMAGE_FORMAT_YCBCR
    {0x84, 0x02},
#elif IMG_FORMAT == IMAGE_FORMAT_RGB565
    {0x84, 0x06}, // RGB565:6;CbYCrY:0;CrYCbY:1;YCbYcr:2;YCrYcb:3;
#endif
        
    {0x86, 0x02},
    {0x88, 0x03},
    {0x89, 0x23}, 
    //{0x89, 0x20}, //eric version
    {0x85, 0x08}, 
    {0x8a, 0x00},
    {0x8b, 0x00},
    {0xb0, 0x55},
    {0xc3, 0x00},
    {0xc4, 0x80},
    {0xc5, 0x90},
    {0xc6, 0x3b},
    {0xc7, 0x46},
    {0xec, 0x06},
    {0xed, 0x04},
    {0xee, 0x60},
    {0xef, 0x90},
    {0xb6, 0x01},
    {0x90, 0x01},
    {0x91, 0x00},
    {0x92, 0x00},
    {0x93, 0x00},
    {0x94, 0x00},
    {0x95, 0x04},
    {0x96, 0xb0},
    {0x97, 0x06},
    {0x98, 0x40},
    /////////////////////////////////////////
    /////////// BLK ////////////////////////
    /////////////////////////////////////////
#if BLK_ON == YES
    {0xfe, 0x00},
    {0x40, 0x42},
    {0x41, 0x00},
    {0x43, 0x5b}, 
    {0x5e, 0x00}, 
    {0x5f, 0x00},
    {0x60, 0x00}, 
    {0x61, 0x00}, 
    {0x62, 0x00},
    {0x63, 0x00}, 
    {0x64, 0x00}, 
    {0x65, 0x00}, 
    {0x66, 0x20},
    {0x67, 0x20}, 
    {0x68, 0x20}, 
    {0x69, 0x20}, 
    {0x76, 0x00}, 																 
    {0x6a, 0x08}, 
    {0x6b, 0x08}, 
    {0x6c, 0x08}, 
    {0x6d, 0x08}, 
    {0x6e, 0x08}, 
    {0x6f, 0x08}, 
    {0x70, 0x08}, 
    {0x71, 0x08}, 	
    {0x76, 0x00},
    {0x72, 0xf0},
    {0x7e, 0x3c},
    {0x7f, 0x00},
    {0xfe, 0x02},
    {0x48, 0x15},
    {0x49, 0x00},
    {0x4b, 0x0b},
    {0xfe, 0x00},
#endif
    ////////////////////////////////////////
    /////////// AEC ////////////////////////
    ////////////////////////////////////////
#if AEC_ON == YES
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0xc0},
    {0x03, 0x04},
    {0x04, 0x90},
    {0x05, 0x30},
    {0x06, 0x90},
    {0x07, 0x30},
    {0x08, 0x80},
    {0x09, 0x00},
    {0x0a, 0x82},
    {0x0b, 0x11},
    {0x0c, 0x10},
    {0x11, 0x10},
    {0x13, 0x7b},
    {0x17, 0x00},
    {0x1c, 0x11},
    {0x1e, 0x61},
    {0x1f, 0x35},
    {0x20, 0x40},
    {0x22, 0x40},
    {0x23, 0x20},
    {0xfe, 0x02},
    {0x0f, 0x04},
    {0xfe, 0x01},
    {0x12, 0x35},
    {0x15, 0xb0},
    {0x10, 0x31},
    {0x3e, 0x28},
    {0x3f, 0xb0},
    {0x40, 0x90},
    {0x41, 0x0f},
#endif
    /////////////////////////////
    //////// INTPEE /////////////
    /////////////////////////////
    {0xfe, 0x02},
    {0x90, 0x6c},
    {0x91, 0x03},
    {0x92, 0xcb},
    {0x94, 0x33},
    {0x95, 0x84},
    {0x97, 0x65},
    {0xa2, 0x11},
    {0xfe, 0x00},
    /////////////////////////////
    //////// DNDD///////////////
    /////////////////////////////
    {0xfe, 0x02},
    {0x80, 0xc1},
    {0x81, 0x08},
    {0x82, 0x05},
    {0x83, 0x08},
    {0x84, 0x0a},
    {0x86, 0xf0},
    {0x87, 0x50},
    {0x88, 0x15},
    {0x89, 0xb0},
    {0x8a, 0x30},
    {0x8b, 0x10},
    /////////////////////////////////////////
    /////////// ASDE ////////////////////////
    /////////////////////////////////////////
    {0xfe, 0x01},
    {0x21, 0x04},
    {0xfe, 0x02},
    {0xa3, 0x50},
    {0xa4, 0x20},
    {0xa5, 0x40},
    {0xa6, 0x80},
    {0xab, 0x40},
    {0xae, 0x0c},
    {0xb3, 0x46},
    {0xb4, 0x64},
    {0xb6, 0x38},
    {0xb7, 0x01},
    {0xb9, 0x2b},
    {0x3c, 0x04},
    {0x3d, 0x15},
    {0x4b, 0x06},
    {0x4c, 0x20},
    {0xfe, 0x00},
    /////////////////////////////////////////
    /////////// GAMMA 	////////////////////////
    /////////////////////////////////////////
 #if GAMMA_1 == YES
    ///////////////////gamma1////////////////////
#if 1
    {0xfe, 0x02},
    {0x10, 0x09},
    {0x11, 0x0d},
    {0x12, 0x13},
    {0x13, 0x19},
    {0x14, 0x27},
    {0x15, 0x37},
    {0x16, 0x45},
    {0x17, 0x53},
    {0x18, 0x69},
    {0x19, 0x7d},
    {0x1a, 0x8f},
    {0x1b, 0x9d},
    {0x1c, 0xa9},
    {0x1d, 0xbd},
    {0x1e, 0xcd},
    {0x1f, 0xd9},
    {0x20, 0xe3},
    {0x21, 0xea},
    {0x22, 0xef},
    {0x23, 0xf5},
    {0x24, 0xf9},
    {0x25, 0xff},
#else                               
    {0xfe, 0x02},
    {0x10, 0x0a},
    {0x11, 0x12},
    {0x12, 0x19},
    {0x13, 0x1f},
    {0x14, 0x2c},
    {0x15, 0x38},
    {0x16, 0x42},
    {0x17, 0x4e},
    {0x18, 0x63},
    {0x19, 0x76},
    {0x1a, 0x87},
    {0x1b, 0x96},
    {0x1c, 0xa2},
    {0x1d, 0xb8},
    {0x1e, 0xcb},
    {0x1f, 0xd8},
    {0x20, 0xe2},
    {0x21, 0xe9},
    {0x22, 0xf0},
    {0x23, 0xf8},
    {0x24, 0xfd},
    {0x25, 0xff},
    {0xfe, 0x00}, 		
#endif 
    {0xfe, 0x00}, 		
    {0xc6, 0x20},
    {0xc7, 0x2b},
#endif
#if GAMMA_2 == YES
    ///////////////////gamma2////////////////////
#if 1
    {0xfe, 0x02},
    {0x26, 0x0f},
    {0x27, 0x14},
    {0x28, 0x19},
    {0x29, 0x1e},
    {0x2a, 0x27},
    {0x2b, 0x33},
    {0x2c, 0x3b},
    {0x2d, 0x45},
    {0x2e, 0x59},
    {0x2f, 0x69},
    {0x30, 0x7c},
    {0x31, 0x89},
    {0x32, 0x98},
    {0x33, 0xae},
    {0x34, 0xc0},
    {0x35, 0xcf},
    {0x36, 0xda},
    {0x37, 0xe2},
    {0x38, 0xe9},
    {0x39, 0xf3},
    {0x3a, 0xf9},
    {0x3b, 0xff},
#else
    ////Gamma outdoor
    {0xfe, 0x02},
    {0x26, 0x17},
    {0x27, 0x18},
    {0x28, 0x1c},
    {0x29, 0x20},
    {0x2a, 0x28},
    {0x2b, 0x34},
    {0x2c, 0x40},
    {0x2d, 0x49},
    {0x2e, 0x5b},
    {0x2f, 0x6d},
    {0x30, 0x7d},
    {0x31, 0x89},
    {0x32, 0x97},
    {0x33, 0xac},
    {0x34, 0xc0},
    {0x35, 0xcf},
    {0x36, 0xda},
    {0x37, 0xe5},
    {0x38, 0xec},
    {0x39, 0xf8},
    {0x3a, 0xfd},
    {0x3b, 0xff},
#endif
#endif
    /////////////////////////////////////////////// 
    ///////////YCP /////////////////////// 
    /////////////////////////////////////////////// 
    {0xfe, 0x02},
    {0xd1, 0x00},
    {0xd2, 0x00},
    {0xd3, 0x40},
    {0xd6, 0xf0},
    {0xd7, 0x10},
    {0xd8, 0xda},
    {0xdd, 0x14},
    {0xde, 0x86},
    {0xed, 0x80},
    {0xee, 0x00},
    {0xef, 0x3f},
    {0xd8, 0xd8},
    ///////////////////abs/////////////////
    {0xfe, 0x01},
    {0x9f, 0x40},
#if LSC_ON == YES    
    /////////////////////////////////////////////
    //////////////////////// LSC ///////////////
    //////////////////////////////////////////
    {0xfe, 0x01},
    {0xc2, 0x14},
    {0xc3, 0x0d},
    {0xc4, 0x0c},
    {0xc8, 0x15},
    {0xc9, 0x0d},
    {0xca, 0x0a},
    {0xbc, 0x24},
    {0xbd, 0x10},
    {0xbe, 0x0b},
    {0xb6, 0x25},
    {0xb7, 0x16},
    {0xb8, 0x15},
    {0xc5, 0x00},
    {0xc6, 0x00},
    {0xc7, 0x00},
    {0xcb, 0x00},
    {0xcc, 0x00},
    {0xcd, 0x00},
    {0xbf, 0x07},
    {0xc0, 0x00},
    {0xc1, 0x00},
    {0xb9, 0x00},
    {0xba, 0x00},
    {0xbb, 0x00},
    {0xaa, 0x01},
    {0xab, 0x01},
    {0xac, 0x00},
    {0xad, 0x05},
    {0xae, 0x06},
    {0xaf, 0x0e},
    {0xb0, 0x0b},
    {0xb1, 0x07},
    {0xb2, 0x06},
    {0xb3, 0x17},
    {0xb4, 0x0e},
    {0xb5, 0x0e},
    {0xd0, 0x09},
    {0xd1, 0x00},
    {0xd2, 0x00},
    {0xd6, 0x08},
    {0xd7, 0x00},
    {0xd8, 0x00},
    {0xd9, 0x00},
    {0xda, 0x00},
    {0xdb, 0x00},
    {0xd3, 0x0a},
    {0xd4, 0x00},
    {0xd5, 0x00},
    {0xa4, 0x00},
    {0xa5, 0x00},
    {0xa6, 0x77},
    {0xa7, 0x77},
    {0xa8, 0x77},
    {0xa9, 0x77},
    {0xa1, 0x80},
    {0xa2, 0x80},
                                 
    {0xfe, 0x01},
    {0xdf, 0x0d},
    {0xdc, 0x25},
    {0xdd, 0x30},
    {0xe0, 0x77},
    {0xe1, 0x80},
    {0xe2, 0x77},
    {0xe3, 0x90},
    {0xe6, 0x90},
    {0xe7, 0xa0},
    {0xe8, 0x90},
    {0xe9, 0xa0}, 																		 
    {0xfe, 0x00},
#endif   


    //////////////////////////////////////////
    ///////////ABS ////////////////////
    //////////////////////////////////////////
    {0xfe, 0x01},
    {0x9f, 0x40},
    {0xfe, 0x00}, 
    //////////////////////////////////////
    ///////////  OUTPUT 	////////////////
    //////////////////////////////////////
    {0xfe, 0x00},
    {0xf2, 0x00},
    
    //////////////frame rate 50Hz/////////
    #if FPS_NORMAL == YES
    {0xfe, 0x00},
    {0x05, 0x01},
    {0x06, 0x56},
    {0x07, 0x00},
    {0x08, 0x32},
    {0xfe, 0x01},
    {0x25, 0x00},
    {0x26, 0xfa}, 
    {0x27, 0x04}, 
    {0x28, 0xe2}, //20fps 
    {0x29, 0x06}, 
    {0x2a, 0xd6}, //14fps 
    {0x2b, 0x07}, 
    {0x2c, 0xd0}, //12fps
    {0x2d, 0x0b}, 
    {0x2e, 0xb8}, //8fps
    {0xfe, 0x00},
    #else
    #if GC_FPS_30 == YES
	{0xfe,0x00},
	{0x05,0x01},
	{0x06,0x30},
	{0x07,0x00},
	{0x08,0x0c},
	{0xfe,0x01},
	{0x25,0x01},
	{0x26,0x75}, 
	{0x27,0x04}, 
	{0x28,0x5f}, //30fps 
	{0x29,0x04}, 
	{0x2a,0x5f},
	{0x2b,0x04}, 
	{0x2c,0x5f}, 
	{0x2d,0x04}, 
	{0x2e,0x5f},
	{0xfe,0x00},
	#else
    {0xfe, 0x00},
    {0x05, 0x01},
    {0x06, 0x43},
    {0x07, 0x00},
    {0x08, 0x4e},
    {0xfe, 0x01},
    {0x25, 0x01},
    {0x26, 0x06}, 
    {0x27, 0x05}, 
    {0x28, 0x1e}, //20fps 
    {0x29, 0x05}, 
    {0x2a, 0x1e}, 
    {0x2b, 0x05}, 
    {0x2c, 0x1e}, 
    {0x2d, 0x05}, 
    {0x2e, 0x1e}, 
    {0xfe, 0x00},
    #endif
    #endif
    ///////////////dark sun////////////////////
    {0xfe, 0x02},
    {0x40, 0xbf},
    {0x46, 0xcf},
    {0xfe, 0x00},
    /////////////////////////////////////////////////////
    //////////////////////	 MIPI 	/////////////////////
    /////////////////////////////////////////////////////
    {0xfe, 0x03}, // P3
    {0x02, 0x22},
    {0x03, 0x10}, // 0x12 20140821
    {0x04, 0x10}, // 0x01 
    {0x05, 0x00},
    {0x06, 0x88},
    
#if IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
    {0x01, 0x87}, // clk lane_p2s_sel, phy_lane1_en, phy_lane0_en, phy_clk_en
    {0x10, 0x95}, // lane_enable, MIPI_enable, RAW8, double_lane
#else
    {0x01, 0x83}, // clk lane_p2s_sel,               phy_lane0_en, phy_clk_en
    {0x10, 0x94}, // lane_enable, MIPI_enable, RAW8
#endif

#if IMG_FORMAT == IMAGE_FORMAT_YCBCR
    {0x11, 0x1e},
#elif IMG_FORMAT == IMAGE_FORMAT_RGB565
    {0x11, 0x22},
#endif
    
    {0x12, 0x80},
    {0x13, 0x0c},
    {0x15, 0x10},
    {0x17, 0xf0},
    
    {0x21, 0x10},
    {0x22, 0x04},
    {0x23, 0x10},
    {0x24, 0x10},
    {0x25, 0x10},
    {0x26, 0x05},
    {0x29, 0x03},
    {0x2a, 0x0a},
    {0x2b, 0x06},
    
    {0xfe, 0x00}, // P0
    //SENSORDB("GC2145MIPI_Sensor_SVGA");
    
    {0xfe, 0x00}, // P0
    {0xfd, 0x01}, // column scalar mode
    {0xfa, 0x00},
    //// crop window						 
    {0xfe, 0x00},
    {0x90, 0x01},
    //out_win_y1
    {0x91, (u8)(((CROPPING_OFFSET_Y) >> 8) & 0xff)},
    {0x92, (u8)((CROPPING_OFFSET_Y) & 0xff)},
    //out_win_x1

    {0x93, (u8)(((CROPPING_OFFSET_X) >> 8) & 0xff)},
    {0x94, (u8)((CROPPING_OFFSET_X) & 0xff)},

// #if IMG_RES == RES_640_480
//     // 640X480
//     // Out window height
//     {0x95, 0x01}, 
//     {0x96, 0xe0},
//     // Out window width
//     {0x97, 0x02},
//     {0x98, 0x80},
// #elif IMG_RES == RES_480_272
//     // 480x272
//     // Out window height
//     {0x95, 0x01},
//     {0x96, 0x10},
//     // Out window width
//     {0x97, 0x01},
//     {0x98, 0xe0},
// #elif IMG_RES == RES_1600_1200
//     {0xfd, 0x00}, // scalar mode
//     // 1600x1200
//     // Out window height
//     {0x95, 0x04},
//     {0x96, 0xb0},
//     // Out window width
//     {0x97, 0x06},
//     {0x98, 0x40},
// #elif IMG_RES == RES_400_600
//     // 640X480
//     // Out window height
//     {0x95, 0x02}, 
//     {0x96, 0x58},
//     // Out window width
//     {0x97, 0x01},
//     {0x98, 0x90},
// #endif

    // Out window height
    {0x95, (u8)((IMG_HEIGHT >> 8) & 0xff)},
    {0x96, (u8)(IMG_HEIGHT & 0xff)},
    // Out window width
    {0x97, (u8)((IMG_WIDTH >> 8) & 0xff)},
    {0x98, (u8)(IMG_WIDTH & 0xff)},
    
    {0x99, 0x11},
    {0x9a, 0x06},
#if IMG_RES == RES_1600_1200
    //// AWB										 
    {0xfe, 0x00},
    {0xec, 0x06},
    {0xed, 0x04},
    {0xee, 0x60},
    {0xef, 0x90},
//		{0x8c, 0x01},		// test pattern
//    {0xfe, 0x02},
//    {0x9d, 0x08},
    {0xfe, 0x01},
    {0x74, 0x01},
    //// AEC										 
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0xc0},
    {0x03, 0x04},
    {0x04, 0x90},
    {0x05, 0x30},
    {0x06, 0x90},
    {0x07, 0x30},
    {0x08, 0x80},
    {0x0a, 0x82},
    {0x21, 0x04},
#else
    //// AWB										 
    {0xfe, 0x00},
    {0xec, 0x02},
    {0xed, 0x02},
    {0xee, 0x30},
    {0xef, 0x48},
//		{0x8c, 0x01},		// test pattern
    {0xfe, 0x02},
    {0x9d, 0x08},
    {0xfe, 0x01},
    {0x74, 0x00},
    //// AEC										 
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0x60},
    {0x03, 0x02},
    {0x04, 0x48},
    {0x05, 0x18},
    {0x06, 0x50},
    {0x07, 0x10},
    {0x08, 0x38},
    {0x0a, 0x80},
    {0x21, 0x04},
#endif
    {0xfe, 0x00},
    {0x20, 0x03},
    //// mipi
    {0xfe, 0x03}, //P3, CSI/PHY1.0
    
// #if IMG_RES == RES_640_480
//     {0x12, 0x00}, // LWC_set
//     {0x13, 0x05},
// #elif IMG_RES == RES_480_272
//     {0x12, 0xc0}, // LWC_set
//     {0x13, 0x03},
// #elif IMG_RES == RES_1600_1200
//     {0x12, 0x80}, // LWC_set
//     {0x13, 0x0c},
// #endif
    {0x12, (u8)((IMG_WIDTH << 1) & 0xff)}, // LWC_set
    {0x13, (u8)((IMG_WIDTH >> 7) & 0xff)},
    
#if GC2145_FULL_RES == YES
        //FIFO full level
    #if IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
        //400 ?
        {0x04, 0x01}, 
        {0x05, 0x00},
    #elif IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_1
        // 1 ?
        {0x04, 0x01},
        {0x05, 0x00},
    #endif   
#else
    #if IMGSRC_1_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
        //400 ?
//        {0x04, 0x90},
//        {0x05, 0x01},
        {0x04, (u8)((IMG_WIDTH>>1) & 0xFF)},
        {0x05, (u8)(((IMG_WIDTH>>1)>>8) & 0xFF)},
    #elif IMGSRC_1_MIPILANE_NUM == IMAGE_MIPILANE_NUM_1
        // 1 ?
        {0x04, 0x01},
        {0x05, 0x00},
    #endif
#endif


    {0xfe, 0x00},

    {0x00, 0x00},
};

#else


#define LSC_ON YES
#define GAMMA_1 YES
#define GAMMA_2 YES
#define BLK_ON YES
#define AEC_ON YES

struct sensor_init_seq INITDATA gc2145_init_regs[] = {  
    //SENSORDB("GC2145MIPI_Sensor_Init");
    // reset : soft_reset, cm_reset, mipi_reset
    {0xfe, 0xf0}, 
    {0xfe, 0xf0}, 
    {0xfe, 0xf0}, 
    
    //pll / clock
    {0xfc, 0x06}, // vpll_en, vpix_en, analog pwd enable=0
    {0xf6, 0x00}, // up_dn : not pull. PWD : pull down
    {0xf7, 0x1d}, //PLL_mode1 [7]not dvp, serial_clk_double = 1, clk_double=1, div2_en=0, pll_en=1
    {0xf8, 0x84}, //PLL_mode2 [7]pll_dgdiv_en=1, [5:0]divx4 = 4
    {0xfa, 0x00}, //clk_div_mode [7:4]divide_by : 0, [3:0]clock_duty = 0
    {0xf9, 0x8e}, //regf clk enable, isp all clock enable, serial clk enable, re_lock_pll
    {0xf2, 0x00}, 
    
    /////////////////////////////////////////////////
    //////////////////ISP reg//////////////////////
    ////////////////////////////////////////////////////
    //reset release
    {0xfe, 0x00},     
    //Exposure : 1250
    {0x03, 0x04},
    {0x04, 0xe2},
    //Row Start
    {0x09, 0x00},
    {0x0a, 0x00},
    //Col Start
    {0x0b, 0x00},
    {0x0c, 0x00},
    //Window Height : 1216 , 4c0h
    {0x0d, 0x04},
    {0x0e, 0xc0},
    //Window Width : 1618
    {0x0f, 0x06},
    {0x10, 0x52},
    
    {0x12, 0x2e},
#ifdef CFG_GC2145_X_Y_INVERSE
#if CFG_GC2145_X_Y_INVERSE
    {0x17, 0x16}, //updown or mirror[bit0]
#else
    {0x17, 0x15}, //updown or mirror[bit0]
#endif
#else
    {0x17, (0x14 | (IMG_MIRROR) | (IMG_FLIP << 1))}, //updown[bit1] or mirror[bit0]
#endif
    {0x18, 0x22},
    {0x19, 0x0e},
    {0x1a, 0x01},
    {0x1b, 0x4b},
    {0x1c, 0x07},
    {0x1d, 0x10},
    {0x1e, 0x88},
    {0x1f, 0x78},
    {0x20, 0x03},
    {0x21, 0x40},
    {0x22, 0xa0}, 
    {0x24, 0x16},
    {0x25, 0x01},
    {0x26, 0x10},
    {0x2d, 0x60},
    {0x30, 0x01},
    {0x31, 0x90},
    {0x33, 0x06},
    {0x34, 0x01},
    /////////////////////////////////////////////////
    //////////////////ISP reg////////////////////
    /////////////////////////////////////////////////
    {0xfe, 0x00},
    {0x80, 0x7f},
    {0x81, 0x26},
    {0x82, 0xfa},
    {0x83, 0x00}, //special effect
    
#if IMG_FORMAT == IMAGE_FORMAT_YCBCR
    {0x84, 0x02},
#elif IMG_FORMAT == IMAGE_FORMAT_RGB565
    {0x84, 0x06}, // RGB565:6;CbYCrY:0;CrYCbY:1;YCbYcr:2;YCrYcb:3;
#endif
        
    {0x86, 0x02},
    {0x88, 0x03},
    {0x89, 0x23}, 
    //{0x89, 0x20}, //eric version
    {0x85, 0x08}, 
    {0x8a, 0x00},
    {0x8b, 0x00},
    {0xb0, 0x55},
    {0xc3, 0x00},
    {0xc4, 0x80},
    {0xc5, 0x90},
    {0xc6, 0x3b},
    {0xc7, 0x46},
    {0xec, 0x06},
    {0xed, 0x04},
    {0xee, 0x60},
    {0xef, 0x90},
    {0xb6, 0x01},
    {0x90, 0x01},
    {0x91, 0x00},
    {0x92, 0x00},
    {0x93, 0x00},
    {0x94, 0x00},
    {0x95, 0x04},
    {0x96, 0xb0},
    {0x97, 0x06},
    {0x98, 0x40},
    /////////////////////////////////////////
    /////////// BLK ////////////////////////
    /////////////////////////////////////////
#if BLK_ON == YES
    {0xfe, 0x00},
    {0x40, 0x42},
    {0x41, 0x00},
    {0x43, 0x5b}, 
    {0x5e, 0x00}, 
    {0x5f, 0x00},
    {0x60, 0x00}, 
    {0x61, 0x00}, 
    {0x62, 0x00},
    {0x63, 0x00}, 
    {0x64, 0x00}, 
    {0x65, 0x00}, 
    {0x66, 0x20},
    {0x67, 0x20}, 
    {0x68, 0x20}, 
    {0x69, 0x20}, 
    {0x76, 0x00}, 																 
    {0x6a, 0x08}, 
    {0x6b, 0x08}, 
    {0x6c, 0x08}, 
    {0x6d, 0x08}, 
    {0x6e, 0x08}, 
    {0x6f, 0x08}, 
    {0x70, 0x08}, 
    {0x71, 0x08}, 	
    {0x76, 0x00},
    {0x72, 0xf0},
    {0x7e, 0x3c},
    {0x7f, 0x00},
    {0xfe, 0x02},
    {0x48, 0x15},
    {0x49, 0x00},
    {0x4b, 0x0b},
    {0xfe, 0x00},
#endif
    ////////////////////////////////////////
    /////////// AEC ////////////////////////
    ////////////////////////////////////////
#if AEC_ON == YES
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0xc0},
    {0x03, 0x04},
    {0x04, 0x90},
    {0x05, 0x30},
    {0x06, 0x90},
    {0x07, 0x30},
    {0x08, 0x80},
    {0x09, 0x00},
    {0x0a, 0x82},
    {0x0b, 0x11},
    {0x0c, 0x10},
    {0x11, 0x10},
    {0x13, 0x7b},
    {0x17, 0x00},
    {0x1c, 0x11},
    {0x1e, 0x61},
    {0x1f, 0x35},
    {0x20, 0x40},
    {0x22, 0x40},
    {0x23, 0x20},
    {0xfe, 0x02},
    {0x0f, 0x04},
    {0xfe, 0x01},
    {0x12, 0x35},
    {0x15, 0xb0},
    {0x10, 0x31},
    {0x3e, 0x28},
    {0x3f, 0xb0},
    {0x40, 0x90},
    {0x41, 0x0f},
#endif
    /////////////////////////////
    //////// INTPEE /////////////
    /////////////////////////////
    {0xfe, 0x02},
    {0x90, 0x6c},
    {0x91, 0x03},
    {0x92, 0xcb},
    {0x94, 0x33},
    {0x95, 0x84},
    {0x97, 0x65},
    {0xa2, 0x11},
    {0xfe, 0x00},
    /////////////////////////////
    //////// DNDD///////////////
    /////////////////////////////
    {0xfe, 0x02},
    {0x80, 0xc1},
    {0x81, 0x08},
    {0x82, 0x05},
    {0x83, 0x08},
    {0x84, 0x0a},
    {0x86, 0xf0},
    {0x87, 0x50},
    {0x88, 0x15},
    {0x89, 0xb0},
    {0x8a, 0x30},
    {0x8b, 0x10},
    /////////////////////////////////////////
    /////////// ASDE ////////////////////////
    /////////////////////////////////////////
    {0xfe, 0x01},
    {0x21, 0x04},
    {0xfe, 0x02},
    {0xa3, 0x50},
    {0xa4, 0x20},
    {0xa5, 0x40},
    {0xa6, 0x80},
    {0xab, 0x40},
    {0xae, 0x0c},
    {0xb3, 0x46},
    {0xb4, 0x64},
    {0xb6, 0x38},
    {0xb7, 0x01},
    {0xb9, 0x2b},
    {0x3c, 0x04},
    {0x3d, 0x15},
    {0x4b, 0x06},
    {0x4c, 0x20},
    {0xfe, 0x00},
    /////////////////////////////////////////
    /////////// GAMMA 	////////////////////////
    /////////////////////////////////////////
 #if GAMMA_1 == YES
    ///////////////////gamma1////////////////////
#if 1
    {0xfe, 0x02},
    {0x10, 0x09},
    {0x11, 0x0d},
    {0x12, 0x13},
    {0x13, 0x19},
    {0x14, 0x27},
    {0x15, 0x37},
    {0x16, 0x45},
    {0x17, 0x53},
    {0x18, 0x69},
    {0x19, 0x7d},
    {0x1a, 0x8f},
    {0x1b, 0x9d},
    {0x1c, 0xa9},
    {0x1d, 0xbd},
    {0x1e, 0xcd},
    {0x1f, 0xd9},
    {0x20, 0xe3},
    {0x21, 0xea},
    {0x22, 0xef},
    {0x23, 0xf5},
    {0x24, 0xf9},
    {0x25, 0xff},
#else                               
    {0xfe, 0x02},
    {0x10, 0x0a},
    {0x11, 0x12},
    {0x12, 0x19},
    {0x13, 0x1f},
    {0x14, 0x2c},
    {0x15, 0x38},
    {0x16, 0x42},
    {0x17, 0x4e},
    {0x18, 0x63},
    {0x19, 0x76},
    {0x1a, 0x87},
    {0x1b, 0x96},
    {0x1c, 0xa2},
    {0x1d, 0xb8},
    {0x1e, 0xcb},
    {0x1f, 0xd8},
    {0x20, 0xe2},
    {0x21, 0xe9},
    {0x22, 0xf0},
    {0x23, 0xf8},
    {0x24, 0xfd},
    {0x25, 0xff},
    {0xfe, 0x00}, 		
#endif 
    {0xfe, 0x00}, 		
    {0xc6, 0x20},
    {0xc7, 0x2b},
#endif
#if GAMMA_2 == YES
    ///////////////////gamma2////////////////////
#if 1
    {0xfe, 0x02},
    {0x26, 0x0f},
    {0x27, 0x14},
    {0x28, 0x19},
    {0x29, 0x1e},
    {0x2a, 0x27},
    {0x2b, 0x33},
    {0x2c, 0x3b},
    {0x2d, 0x45},
    {0x2e, 0x59},
    {0x2f, 0x69},
    {0x30, 0x7c},
    {0x31, 0x89},
    {0x32, 0x98},
    {0x33, 0xae},
    {0x34, 0xc0},
    {0x35, 0xcf},
    {0x36, 0xda},
    {0x37, 0xe2},
    {0x38, 0xe9},
    {0x39, 0xf3},
    {0x3a, 0xf9},
    {0x3b, 0xff},
#else
    ////Gamma outdoor
    {0xfe, 0x02},
    {0x26, 0x17},
    {0x27, 0x18},
    {0x28, 0x1c},
    {0x29, 0x20},
    {0x2a, 0x28},
    {0x2b, 0x34},
    {0x2c, 0x40},
    {0x2d, 0x49},
    {0x2e, 0x5b},
    {0x2f, 0x6d},
    {0x30, 0x7d},
    {0x31, 0x89},
    {0x32, 0x97},
    {0x33, 0xac},
    {0x34, 0xc0},
    {0x35, 0xcf},
    {0x36, 0xda},
    {0x37, 0xe5},
    {0x38, 0xec},
    {0x39, 0xf8},
    {0x3a, 0xfd},
    {0x3b, 0xff},
#endif
#endif
    /////////////////////////////////////////////// 
    ///////////YCP /////////////////////// 
    /////////////////////////////////////////////// 
    {0xfe, 0x02},
    {0xd1, 0x32},
    {0xd2, 0x32},
    {0xd3, 0x40},
    {0xd6, 0xf0},
    {0xd7, 0x10},
    {0xd8, 0xda},
    {0xdd, 0x14},
    {0xde, 0x86},
    {0xed, 0x80},
    {0xee, 0x00},
    {0xef, 0x3f},
    {0xd8, 0xd8},
    ///////////////////abs/////////////////
    {0xfe, 0x01},
    {0x9f, 0x40},
#if LSC_ON == YES    
    /////////////////////////////////////////////
    //////////////////////// LSC ///////////////
    //////////////////////////////////////////
    {0xfe, 0x01},
    {0xc2, 0x14},
    {0xc3, 0x0d},
    {0xc4, 0x0c},
    {0xc8, 0x15},
    {0xc9, 0x0d},
    {0xca, 0x0a},
    {0xbc, 0x24},
    {0xbd, 0x10},
    {0xbe, 0x0b},
    {0xb6, 0x25},
    {0xb7, 0x16},
    {0xb8, 0x15},
    {0xc5, 0x00},
    {0xc6, 0x00},
    {0xc7, 0x00},
    {0xcb, 0x00},
    {0xcc, 0x00},
    {0xcd, 0x00},
    {0xbf, 0x07},
    {0xc0, 0x00},
    {0xc1, 0x00},
    {0xb9, 0x00},
    {0xba, 0x00},
    {0xbb, 0x00},
    {0xaa, 0x01},
    {0xab, 0x01},
    {0xac, 0x00},
    {0xad, 0x05},
    {0xae, 0x06},
    {0xaf, 0x0e},
    {0xb0, 0x0b},
    {0xb1, 0x07},
    {0xb2, 0x06},
    {0xb3, 0x17},
    {0xb4, 0x0e},
    {0xb5, 0x0e},
    {0xd0, 0x09},
    {0xd1, 0x00},
    {0xd2, 0x00},
    {0xd6, 0x08},
    {0xd7, 0x00},
    {0xd8, 0x00},
    {0xd9, 0x00},
    {0xda, 0x00},
    {0xdb, 0x00},
    {0xd3, 0x0a},
    {0xd4, 0x00},
    {0xd5, 0x00},
    {0xa4, 0x00},
    {0xa5, 0x00},
    {0xa6, 0x77},
    {0xa7, 0x77},
    {0xa8, 0x77},
    {0xa9, 0x77},
    {0xa1, 0x80},
    {0xa2, 0x80},
                                 
    {0xfe, 0x01},
    {0xdf, 0x0d},
    {0xdc, 0x25},
    {0xdd, 0x30},
    {0xe0, 0x77},
    {0xe1, 0x80},
    {0xe2, 0x77},
    {0xe3, 0x90},
    {0xe6, 0x90},
    {0xe7, 0xa0},
    {0xe8, 0x90},
    {0xe9, 0xa0}, 																		 
    {0xfe, 0x00},
#endif   

    ///////////////////////////////////////////////
    /////////// AWB////////////////////////
    ///////////////////////////////////////////////
    {0xfe, 0x01},
    {0x4f, 0x00},
    {0x4f, 0x00},
    {0x4b, 0x01},
    {0x4f, 0x00},
                     
    {0x4c, 0x01}, // D75
    {0x4d, 0x71},
    {0x4e, 0x01},
    {0x4c, 0x01},
    {0x4d, 0x91},
    {0x4e, 0x01},
    {0x4c, 0x01},
    {0x4d, 0x70},
    {0x4e, 0x01},
                     
    {0x4c, 0x01}, // D65
    {0x4d, 0x90},
    {0x4e, 0x02}, 																	 
                     
                     
    {0x4c, 0x01},
    {0x4d, 0xb0},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0x8f},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0x6f},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0xaf},
    {0x4e, 0x02},
                     
    {0x4c, 0x01},
    {0x4d, 0xd0},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0xf0},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0xcf},
    {0x4e, 0x02},
    {0x4c, 0x01},
    {0x4d, 0xef},
    {0x4e, 0x02},
                     
    {0x4c, 0x01},//D50
    {0x4d, 0x6e},
    {0x4e, 0x03},
    {0x4c, 0x01}, 
    {0x4d, 0x8e},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xae},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xce},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x4d},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x6d},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x8d},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xad},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xcd},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x4c},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x6c},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x8c},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xac},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xcc},
    {0x4e, 0x03},
                     
    {0x4c, 0x01},
    {0x4d, 0xcb},
    {0x4e, 0x03},
                     
    {0x4c, 0x01},
    {0x4d, 0x4b},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x6b},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0x8b},
    {0x4e, 0x03},
    {0x4c, 0x01},
    {0x4d, 0xab},
    {0x4e, 0x03},
                     
    {0x4c, 0x01},//CWF
    {0x4d, 0x8a},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0xaa},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0xca},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0xca},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0xc9},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0x8a},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0x89},
    {0x4e, 0x04},
    {0x4c, 0x01},
    {0x4d, 0xa9},
    {0x4e, 0x04},
                     
                     
                     
    {0x4c, 0x02},//tl84
    {0x4d, 0x0b},
    {0x4e, 0x05},
    {0x4c, 0x02},
    {0x4d, 0x0a},
    {0x4e, 0x05},
                     
    {0x4c, 0x01},
    {0x4d, 0xeb},
    {0x4e, 0x05},
                     
    {0x4c, 0x01},
    {0x4d, 0xea},
    {0x4e, 0x05},
                                     
    {0x4c, 0x02},
    {0x4d, 0x09},
    {0x4e, 0x05},
    {0x4c, 0x02},
    {0x4d, 0x29},
    {0x4e, 0x05},
                                             
    {0x4c, 0x02},
    {0x4d, 0x2a},
    {0x4e, 0x05},
                                                
    {0x4c, 0x02},
    {0x4d, 0x4a},
    {0x4e, 0x05},
    
    //{0x4c, 0x02}, //A
    //{0x4d, 0x6a},
    //{0x4e, 0x06},
    
    {0x4c, 0x02}, 
    {0x4d, 0x8a},
    {0x4e, 0x06},
                                    
    {0x4c, 0x02},
    {0x4d, 0x49},
    {0x4e, 0x06},
    {0x4c, 0x02},
    {0x4d, 0x69},
    {0x4e, 0x06},
    {0x4c, 0x02},
    {0x4d, 0x89},
    {0x4e, 0x06},
    {0x4c, 0x02},
    {0x4d, 0xa9},
    {0x4e, 0x06},
                                 
    {0x4c, 0x02},
    {0x4d, 0x48},
    {0x4e, 0x06},
    {0x4c, 0x02},
    {0x4d, 0x68},
    {0x4e, 0x06},
    {0x4c, 0x02},
    {0x4d, 0x69},
    {0x4e, 0x06},
                             
    {0x4c, 0x02},//H
    {0x4d, 0xca},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xc9},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xe9},
    {0x4e, 0x07},
    {0x4c, 0x03},
    {0x4d, 0x09},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xc8},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xe8},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xa7},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xc7},
    {0x4e, 0x07},
    {0x4c, 0x02},
    {0x4d, 0xe7},
    {0x4e, 0x07},
    {0x4c, 0x03},
    {0x4d, 0x07},
    {0x4e, 0x07},
    
    {0x4f, 0x01},
    {0x50, 0x80},
    {0x51, 0xa8},
    {0x52, 0x47},
    {0x53, 0x38},
    {0x54, 0xc7},
    {0x56, 0x0e},
    {0x58, 0x08},
    {0x5b, 0x00},
    {0x5c, 0x74},
    {0x5d, 0x8b},
    {0x61, 0xdb},
    {0x62, 0xb8},
    {0x63, 0x86},
    {0x64, 0xc0},
    {0x65, 0x04},
    
    {0x67, 0xa8},
    {0x68, 0xb0},
    {0x69, 0x00},
    {0x6a, 0xa8},
    {0x6b, 0xb0},
    {0x6c, 0xaf},
    {0x6d, 0x8b},
    {0x6e, 0x50},
    {0x6f, 0x18},
    {0x73, 0xf0},
    {0x70, 0x0d},
    {0x71, 0x60},
    {0x72, 0x80},
    {0x74, 0x01},
    {0x75, 0x01},
    {0x7f, 0x0c},
    {0x76, 0x70},
    {0x77, 0x58},
    {0x78, 0xa0},
    {0x79, 0x5e},
    {0x7a, 0x54},
    {0x7b, 0x58}, 																		 
    {0xfe, 0x00},
    
    //////////////////////////////////////////
    ///////////CC////////////////////////
    //////////////////////////////////////////
    {0xfe, 0x02},
    {0xc0, 0x01}, 																	
    {0xc1, 0x44},
    {0xc2, 0xfd},
    {0xc3, 0x04},
    {0xc4, 0xf0},
    {0xc5, 0x48},
    {0xc6, 0xfd},
    {0xc7, 0x46},
    {0xc8, 0xfd},
    {0xc9, 0x02},
    {0xca, 0xe0},
    {0xcb, 0x45},
    {0xcc, 0xec}, 												
    {0xcd, 0x48},
    {0xce, 0xf0},
    {0xcf, 0xf0},
    {0xe3, 0x0c},
    {0xe4, 0x4b},
    {0xe5, 0xe0},
    //////////////////////////////////////////
    ///////////ABS ////////////////////
    //////////////////////////////////////////
    {0xfe, 0x01},
    {0x9f, 0x40},
    {0xfe, 0x00}, 
    //////////////////////////////////////
    ///////////  OUTPUT 	////////////////
    //////////////////////////////////////
    {0xfe, 0x00},
    {0xf2, 0x00},
    
    //////////////frame rate 50Hz/////////
    {0xfe, 0x00},
    {0x05, 0x01},
    {0x06, 0x56},
    {0x07, 0x00},
    {0x08, 0x32},
    {0xfe, 0x01},
    {0x25, 0x00},
    {0x26, 0xfa}, 
    {0x27, 0x04}, 
    {0x28, 0xe2}, //20fps 
    {0x29, 0x06}, 
    {0x2a, 0xd6}, //14fps 
    {0x2b, 0x07}, 
    {0x2c, 0xd0}, //12fps
    {0x2d, 0x0b}, 
    {0x2e, 0xb8}, //8fps
    {0xfe, 0x00},
    
    ///////////////dark sun////////////////////
    {0xfe, 0x02},
    {0x40, 0xbf},
    {0x46, 0xcf},
    {0xfe, 0x00},
    /////////////////////////////////////////////////////
    //////////////////////	 MIPI 	/////////////////////
    /////////////////////////////////////////////////////
    {0xfe, 0x03}, // P3
    {0x02, 0x22},
    {0x03, 0x10}, // 0x12 20140821
    {0x04, 0x10}, // 0x01 
    {0x05, 0x00},
    {0x06, 0x88},
    
#if IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
    {0x01, 0x87}, // clk lane_p2s_sel, phy_lane1_en, phy_lane0_en, phy_clk_en
    {0x10, 0x95}, // lane_enable, MIPI_enable, RAW8, double_lane
#else
    {0x01, 0x83}, // clk lane_p2s_sel,               phy_lane0_en, phy_clk_en
    {0x10, 0x94}, // lane_enable, MIPI_enable, RAW8
#endif

#if IMG_FORMAT == IMAGE_FORMAT_YCBCR
    {0x11, 0x1e},
#elif IMG_FORMAT == IMAGE_FORMAT_RGB565
    {0x11, 0x22},
#endif
    
    {0x12, 0x80},
    {0x13, 0x0c},
    {0x15, 0x10},
    {0x17, 0xf0},
    
    {0x21, 0x10},
    {0x22, 0x04},
    {0x23, 0x10},
    {0x24, 0x10},
    {0x25, 0x10},
    {0x26, 0x05},
    {0x29, 0x03},
    {0x2a, 0x0a},
    {0x2b, 0x06},
    
    {0xfe, 0x00}, // P0
    //SENSORDB("GC2145MIPI_Sensor_SVGA");
    
    {0xfe, 0x00}, // P0
    {0xfd, 0x01}, // column scalar mode
    {0xfa, 0x00},
    //// crop window						 
    {0xfe, 0x00},
    {0x90, 0x01},
    //out_win_y1
    {0x91, 0x00},
    {0x92, 0x00},
    //out_win_x1

    {0x93, (u8)(((CROPPING_OFFSET_X) >> 8) & 0xff)},
    {0x94, (u8)((CROPPING_OFFSET_X) & 0xff)},

// #if IMG_RES == RES_640_480
//     // 640X480
//     // Out window height
//     {0x95, 0x01}, 
//     {0x96, 0xe0},
//     // Out window width
//     {0x97, 0x02},
//     {0x98, 0x80},
// #elif IMG_RES == RES_480_272
//     // 480x272
//     // Out window height
//     {0x95, 0x01},
//     {0x96, 0x10},
//     // Out window width
//     {0x97, 0x01},
//     {0x98, 0xe0},
// #elif IMG_RES == RES_1600_1200
//     {0xfd, 0x00}, // scalar mode
//     // 1600x1200
//     // Out window height
//     {0x95, 0x04},
//     {0x96, 0xb0},
//     // Out window width
//     {0x97, 0x06},
//     {0x98, 0x40},
// #elif IMG_RES == RES_400_600
//     // 640X480
//     // Out window height
//     {0x95, 0x02}, 
//     {0x96, 0x58},
//     // Out window width
//     {0x97, 0x01},
//     {0x98, 0x90},
// #endif

    // Out window height
    {0x95, (u8)((IMG_HEIGHT >> 8) & 0xff)},
    {0x96, (u8)(IMG_HEIGHT & 0xff)},
    // Out window width
    {0x97, (u8)((IMG_WIDTH >> 8) & 0xff)},
    {0x98, (u8)(IMG_WIDTH & 0xff)},
    
    {0x99, 0x11},
    {0x9a, 0x06},
#if IMG_RES == RES_1600_1200
    //// AWB										 
    {0xfe, 0x00},
    {0xec, 0x06},
    {0xed, 0x04},
    {0xee, 0x60},
    {0xef, 0x90},
//		{0x8c, 0x01},		// test pattern
//    {0xfe, 0x02},
//    {0x9d, 0x08},
    {0xfe, 0x01},
    {0x74, 0x01},
    //// AEC										 
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0xc0},
    {0x03, 0x04},
    {0x04, 0x90},
    {0x05, 0x30},
    {0x06, 0x90},
    {0x07, 0x30},
    {0x08, 0x80},
    {0x0a, 0x82},
    {0x21, 0x04},
#else
    //// AWB										 
    {0xfe, 0x00},
    {0xec, 0x02},
    {0xed, 0x02},
    {0xee, 0x30},
    {0xef, 0x48},
//		{0x8c, 0x01},		// test pattern
    {0xfe, 0x02},
    {0x9d, 0x08},
    {0xfe, 0x01},
    {0x74, 0x00},
    //// AEC										 
    {0xfe, 0x01},
    {0x01, 0x04},
    {0x02, 0x60},
    {0x03, 0x02},
    {0x04, 0x48},
    {0x05, 0x18},
    {0x06, 0x50},
    {0x07, 0x10},
    {0x08, 0x38},
    {0x0a, 0x80},
    {0x21, 0x04},
#endif
    {0xfe, 0x00},
    {0x20, 0x03},
    //// mipi
    {0xfe, 0x03}, //P3, CSI/PHY1.0
    
// #if IMG_RES == RES_640_480
//     {0x12, 0x00}, // LWC_set
//     {0x13, 0x05},
// #elif IMG_RES == RES_480_272
//     {0x12, 0xc0}, // LWC_set
//     {0x13, 0x03},
// #elif IMG_RES == RES_1600_1200
//     {0x12, 0x80}, // LWC_set
//     {0x13, 0x0c},
// #endif
    {0x12, (u8)((IMG_WIDTH << 1) & 0xff)}, // LWC_set
    {0x13, (u8)((IMG_WIDTH >> 7) & 0xff)},
    
#if GC2145_FULL_RES == YES
        //FIFO full level
    #if IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
        //400 ?
        {0x04, 0x01}, 
        {0x05, 0x00},
    #elif IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_1
        // 1 ?
        {0x04, 0x01},
        {0x05, 0x00},
    #endif   
#else
    #if IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_2
        //400 ?
        {0x04, 0x90}, 
        {0x05, 0x01},
    #elif IMG_MIPILANE_NUM == IMAGE_MIPILANE_NUM_1
        // 1 ?
        {0x04, 0x01},
        {0x05, 0x00},
    #endif
#endif


    {0xfe, 0x00},

    {0x00, 0x00},
};
#endif

int gc2145_i2c_init(void)
{
    int ret = -1;

    ret = 0;
    
    return ret;
}

static int gc2145_write_reg(struct sensor_device *sensor_dev, u16 reg, u8 data)
{
    int ret;

    ret = kdp_drv_i2c_write(I2C_ADAP_0, sensor_dev->addr, reg, 1, data);

    return ret;
}

static int gc2145_read_reg(struct sensor_device *sensor_dev, u16 reg, u8 *data)
{
	int ret;

    ret = kdp_drv_i2c_read(I2C_ADAP_0, sensor_dev->addr, reg, 1, data);

	return ret;
}

int gc2145_init(struct sensor_device *sensor_dev, struct sensor_init_seq *seq, u32 length)
{
    struct sensor_device *dev = sensor_dev;
    struct sensor_init_seq *init_fnc_ptr = seq;
    //dbg_msg_camera(" gc2145_init ");
    for (u32 i = 0; i < length; i++) {
        if (init_fnc_ptr[i].addr == 0 && init_fnc_ptr[i].value == 0) break; //reaches end
        gc2145_write_reg(dev, init_fnc_ptr[i].addr , (u8)(init_fnc_ptr[i].value & 0xFF));
    }
    //dbg_msg_camera("gc2145_init init over, sensor ID = 0x%x", dev->device_id);
    u8 data = 0;
    gc2145_read_reg(dev, 0xf0, &data);
    //dbg_msg_camera("gc2145_init sensor high id=%x", data);
    dev->device_id = data << 8;
    gc2145_read_reg(dev, 0xf1, &data);
    //dbg_msg_camera("gc2145_init sensor low id=%x", data);
    dev->device_id |= data;
    
    if(dev->device_id != 0x2145)
        return -1;
    
    return 0;
}

static const struct sensor_win_size *gc2145_select_win(u32 *width, u32 *height)
{
    int i, default_size = ARRAY_SIZE(gc2145_supported_win_sizes) - 1;

    for (i = 0; i < ARRAY_SIZE(gc2145_supported_win_sizes); i++) {
        if (gc2145_supported_win_sizes[i].width  >= *width &&
            gc2145_supported_win_sizes[i].height >= *height) {
            *width = gc2145_supported_win_sizes[i].width;
            *height = gc2145_supported_win_sizes[i].height;
            return &gc2145_supported_win_sizes[i];
        }
    }

    *width = gc2145_supported_win_sizes[default_size].width;
    *height = gc2145_supported_win_sizes[default_size].height;
    return &gc2145_supported_win_sizes[default_size];
}

static int gc2145_set_params(
        struct sensor_device *sensor_dev, u32 *width, u32 *height, u32 fourcc)
{
    switch (fourcc) {	
        case V2K_PIX_FMT_YCBCR:
            dbg_msg_camera("%s: Selected V2K_PIX_FMT_YCBCR", __func__);
            break;            
        case V2K_PIX_FMT_RGB565:
            dbg_msg_camera("%s: Selected V2K_PIX_FMT_RGB565", __func__);
            break;
        default:;
    }

    /* reset hardware */
    //gc2145_reset(sensor_dev);

    /* initialize the sensor with default settings */
    return gc2145_init(sensor_dev, gc2145_init_regs, sizeof(gc2145_init_regs)/sizeof(gc2145_init_regs[0]));
}

static int gc2145_sensor_enum_fmt(unsigned int index, unsigned int *code)
{
    if (index >= ARRAY_SIZE(gc2145_colour_fmts))
        return -KDP_FRAMEWORK_ERRNO_INVALA;

    //dbg_msg_camera("   <%s>\n", __func__);
    *code = gc2145_colour_fmts[index].fourcc;
    return 0;
}

static int gc2145_sensor_set_fmt(struct cam_format *fmt)
{
    //dbg_msg_camera("   <%s>\n", __func__);

    gc2145_select_win(&fmt->width, &fmt->height);

    return gc2145_set_params(&gc2145_dev, &fmt->width, &fmt->height, fmt->pixelformat);
}

int gc2145_sensor_set_aec_roi(u8 x1, u8 x2, u8 y1, u8 y2, u8 center_x1, u8 center_x2, u8 center_y1, u8 center_y2)
{
    u8 dev_addr = 0x3c;

    //set to page 1
    u8 reg = 0xfe;
    u8 data = 0x01;
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);

    //set roi
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x01, 1, x1 + ROI_OFFSET_X);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x02, 1, x2 + ROI_OFFSET_X);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x03, 1, y1 + ROI_OFFSET_Y);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x04, 1, y2 + ROI_OFFSET_Y);

    //set center roi
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x05, 1, center_x1 + ROI_OFFSET_X);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x06, 1, center_x2 + ROI_OFFSET_X);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x07, 1, center_y1 + ROI_OFFSET_Y);
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, 0x08, 1, center_y2 + ROI_OFFSET_Y);

    return 0;
}

int gc2145_sensor_set_aec_en( BOOL enable )
{
    u8 dev_addr = 0x3c;

    //set to page 0
    u8 reg = 0xfe;
    u8 data = 0x00;
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);

    if( enable == TRUE ) {
        reg = 0xb6;
        data = 0x01;
        kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);
    }
    else
    {
        reg = 0xb6;
        data = 0x00;
        kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);        
    }   

    return 0;
}

int gc2145_sensor_get_lux(u16* exposure, u8* pre_gain, u8* post_gain, u8* global_gain, u8* y_average)
{
    u8 dev_addr = 0x3c;

    //set to page 0
    u8 reg = 0xfe;
    u8 data = 0x00;
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);

    reg = 0x03; //get exposure
    *exposure = 0;
    data = 0;
    int ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *exposure |= (data << 8);

    reg = 0x04;
    data = 0;
    ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *exposure |= data;

    //get gain
    reg = 0xb1;
    data = 0;
    ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *pre_gain = data;

    reg = 0xb2;
    data = 0;
    ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *post_gain = data;

    // set global gain
    reg = 0xb0;
    data = 0;
    ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *global_gain = data;

    // set to page 1
    reg = 0xfe;
    data = 0x01;
    kdp_drv_i2c_write(I2C_ADAP_0, dev_addr, reg, 1, data);

    // set y_average
    reg = 0x14;
    data = 0;
    ret = kdp_drv_i2c_read(I2C_ADAP_0, dev_addr, reg, 1, &data);
    *y_average = data;

    return 0;
}

static int gc2145_sensor_get_id(void)
{
    //dbg_msg_camera("   <%s>\n", __func__);

    return gc2145_dev.device_id;
}

static struct sensor_ops gc2145_ops = {
//    .s_power    = gc2145_sensor_power,
//    .reset      = gc2145_sensor_reset,
//    .s_stream   = gc2145_sensor_stream,
    .enum_fmt           = gc2145_sensor_enum_fmt,
//    .get_fmt    = gc2145_sensor_get_fmt,
    .set_fmt            = gc2145_sensor_set_fmt,
    .set_gain           = NULL,
    .set_exp_time       = NULL,
    .get_lux            = gc2145_sensor_get_lux,
    .set_aec_roi        = gc2145_sensor_set_aec_roi,
    .set_mirror         = NULL,
    .set_flip           = NULL,
    .get_id             = gc2145_sensor_get_id,
    .set_fps            = NULL,
    .set_aec_en         = gc2145_sensor_set_aec_en,
};

void gc2145_sensor_init(int cam_idx)
{
    //dbg_msg_camera("   <%s>\n", __func__);
    kdp_sensor_register(SENSOR_TYPE_GC2145, &gc2145_ops);
}

#endif
